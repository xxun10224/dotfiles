# # start shell instead of login shell
# set -g default-command "${SHELL}"

# toggle status bar w/o prefix
bind-key -n M-S set status

# status bar on top
set-option -g status-position top

# status bar color
# set -g status-bg "#BAC2DE" 
set-option -g status-style bg=default

# status right
set -g status-right-length 150
# set -g status-right "#[align=absolute-centre] #{s|^$HOME|~|:pane_current_path} #[align=right] %a %m/%d %H:%M \uf240 #(cat /sys/class/power_supply/BAT1/capacity)\% "
set -g status-right "#[align=absolute-centre] #{s|^$HOME|~|:pane_current_path} #[align=right] %a %m/%d %H:%M #(~/.config/tmux/battery-icon.sh) "

# change prefix from 'Ctrl+B' to 'Alt+Space'
unbind C-b
set-option -g prefix M-Space
bind-key M-Space send-prefix

# reload tmux config
bind-key r source-file ~/.config/tmux/tmux.conf

# detach current client w/o prefix
bind-key -n M-d detach-client

# create pane in "dwindle layout" w/o prefix
# bind-key -n M-Enter if-shell "[ $(($(tmux display -p '8*#{pane_width}-20*#{pane_height}'))) -lt 0 ]" "splitw -v -c '#{pane_current_path}'" "splitw -h -c '#{pane_current_path}' "
# bind-key -n M-Enter select-pane -t "{bottom-right}" \; split-window -h -c "#{pane_current_path}" \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-Enter split-window -fh -c "#{pane_current_path}" \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'

# kill pane w/o prefix
bind-key -n M-q kill-pane

# switch focus w/o prefix
bind-key -n M-h select-pane -LZ
bind-key -n M-l select-pane -RZ
bind-key -n M-k select-pane -UZ
bind-key -n M-j select-pane -DZ

# toggle between zoomed and original w/o prefix
bind-key -n M-f resize-pane -Z

# resize pane w/o prefix
bind-key -r C-h resize-pane -L 1
bind-key -r C-j resize-pane -D 1
bind-key -r C-k resize-pane -U 1
bind-key -r C-l resize-pane -R 1

# create or navigate to window of index w/o prefix
bind-key -n M-` if-shell 'tmux select-window -t :0' '' 'new-window -t :0 -c "#{pane_current_path}"'
bind-key -n M-1 if-shell 'tmux select-window -t :1' '' 'new-window -t :1 -c "#{pane_current_path}"'
bind-key -n M-2 if-shell 'tmux select-window -t :2' '' 'new-window -t :2 -c "#{pane_current_path}"'
bind-key -n M-3 if-shell 'tmux select-window -t :3' '' 'new-window -t :3 -c "#{pane_current_path}"'
bind-key -n M-4 if-shell 'tmux select-window -t :4' '' 'new-window -t :4 -c "#{pane_current_path}"'
bind-key -n M-5 if-shell 'tmux select-window -t :5' '' 'new-window -t :5 -c "#{pane_current_path}"'
bind-key -n M-6 if-shell 'tmux select-window -t :6' '' 'new-window -t :6 -c "#{pane_current_path}"'
bind-key -n M-7 if-shell 'tmux select-window -t :7' '' 'new-window -t :7 -c "#{pane_current_path}"'
bind-key -n M-8 if-shell 'tmux select-window -t :8' '' 'new-window -t :8 -c "#{pane_current_path}"'

# navigate to next/previous/last window
bind-key -n M-\| select-window -p
bind-key -n M-\\ select-window -n
bind-key -n M-Tab select-window -l

# kill window w/o prefix
bind-key -n M-Q kill-window

# move pane to window w/o prefix
bind-key -n M-~ if-shell 'tmux join-pane -fh -t :0' '' 'break-pane -t 0' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-! if-shell 'tmux join-pane -fh -t :1' '' 'break-pane -t 1' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-@ if-shell 'tmux join-pane -fh -t :2' '' 'break-pane -t 2' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-# if-shell 'tmux join-pane -fh -t :3' '' 'break-pane -t 3' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-$ if-shell 'tmux join-pane -fh -t :4' '' 'break-pane -t 4' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-% if-shell 'tmux join-pane -fh -t :5' '' 'break-pane -t 5' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-^ if-shell 'tmux join-pane -fh -t :6' '' 'break-pane -t 6' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-& if-shell 'tmux join-pane -fh -t :7' '' 'break-pane -t 7' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'
bind-key -n M-* if-shell 'tmux join-pane -fh -t :8' '' 'break-pane -t 8' \; run-shell '~/.config/tmux/tmux-layout-dwindle brvc'

# # swap windows w/o prefix
# bind-key -n M-~ if-shell 'tmux swap-window -d -t :0' '' 'move-window -t :0'
# bind-key -n M-! if-shell 'tmux swap-window -d -t :1' '' 'move-window -t :1'
# bind-key -n M-@ if-shell 'tmux swap-window -d -t :2' '' 'move-window -t :2'
# bind-key -n M-# if-shell 'tmux swap-window -d -t :3' '' 'move-window -t :3'
# bind-key -n M-$ if-shell 'tmux swap-window -d -t :4' '' 'move-window -t :4'
# bind-key -n M-% if-shell 'tmux swap-window -d -t :5' '' 'move-window -t :5'
# bind-key -n M-^ if-shell 'tmux swap-window -d -t :6' '' 'move-window -t :6'
# bind-key -n M-& if-shell 'tmux swap-window -d -t :7' '' 'move-window -t :7'
# bind-key -n M-* if-shell 'tmux swap-window -d -t :8' '' 'move-window -t :8'

# popup
bind-key -n M-p display-popup -w 80% -h 80% -E "python"
bind-key -n M-b display-popup -d "#{pane_current_path}" -w 80% -h 80% -E "bash"
# bind-key -n M-a display-popup -w 80% -h 80% -E "bash -c yazi"
bind-key -n M-n display-popup -E 'bash -i -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'
bind-key -n M-s display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"
bind-key -n M-i run-shell '~/.config/tmux/popup.sh'
bind-key -n M-\; display-popup -w 80% -h 50% -E ' tmux list-windows -F "#{window_last_accessed} #{window_index}:#{window_name} #{pane_current_command} #{pane_current_path} #{?pane_zoomed,[Z],}" | sort -n | cut -d" " -f2- | fzf --reverse --no-sort --prompt="MRU windows > " | cut -d: -f1 | xargs -r tmux select-window -t '

# minimize escape-time
set -s escape-time 0

# mouse control on
set -g mouse on

# vi copy mode
setw -g mode-keys vi

# main-pane-width for main-vertical layout
set -g main-pane-width 100

# do not jump to end after yanking in copy mode
# unbind-key -T copy-mode-vi MouseDragEnd1Pane
# bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection -x
# bind-key -T copy-mode-vi y send-keys -X copy-selection
set-option -g set-clipboard on
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe "wl-copy"
bind-key -T copy-mode-vi y send-keys -X copy-pipe "wl-copy"

# yazi image preview
set -g allow-passthrough all
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# try chafa w/o --passthrough tmux
# set -g allow-passthrough on
